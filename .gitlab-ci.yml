stages:
  - build
  - test
  #- deploy

image: docker:stable

services:
  - docker:dind

variables:
  - DOCKER_USER: $docker_user
  - DOCKER_PASSWORD: $docker_password
  - PROJECT_NAME: $docker_user/fellipe-gces-entrega02

before_script:
  - echo $DOCKER_PASSWORD | docker login -u $DOCKER_USER --password-stdin

test-backend:
  stage: test
  image: docker/compose:stable
  before_script:
    - echo "TESTING BACKEND . . ."
  script:
    - docker-compose run --entrypoint "npm run unittest" backend
  after_script:
    - echo "BACKEND SUCCESSFULLY TESTED."

test-frontend:
  stage: test
  image: docker/compose:stable
  before_script:
    - echo "TESTING FRONTEND . . ."
  script:
    - docker-compose run --entrypoint "npm run coverage" frontend
  after_script:
    - echo "FRONTEND SUCCESSFULLY TESTED."